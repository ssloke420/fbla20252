<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css"/>
    <title>RHHS Lost and Found Website</title>
    <link rel="icon" type="image/svg+xml" href="images/rhhs_logo.svg">
    <style>
      form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 20px auto;
        float: left;
        margin-left: 25px;
      }

      form label,
      form input,
      form select {
        display: block;
        width: 100%;
      }

      #form-submit {
        position: absolute;
        top: 26%;
        right: 10%;
      }



      img.preview {
        width: 100px;
        height: auto;
      }
    </style>
  </head>

  <body>
    <header> 
      <h1 id="header">RHHS Lost and Found Website</h1> 
    </header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="listings.html">Create New Listing/Browse Found Items</a></li>
        <li><a href="chat.html">Discuss Lost Items</a></li>
        <li><a href="login.html">Admin Login</a></li>
      </ul>
    </nav>

    <div>
      <form id="item-form" style="width: 75%">
        <label>Item Title:</label>
        <input type="text" id="item-title">

        <label>Item Description:</label>
        <input type="text" id="item-desc">

        <label>Picture (Clearly show item, should be easily distinguishable):</label>
        <input type="file" id="item-pic">

        <label>Where to Find (Contact Information, Location, etc.):</label>
        <input type="text" id="item-location">

        <label>Type of Post:</label>
        <select id="item-type">
          <option value="I found this">I found this</option>
          <option value="I am looking for this">I am looking for this</option>
        </select>
      </form>

      <button id="form-submit">Submit</button>
    </div>

    <table id="item-table">
      <tr>
        <th>Item Title</th>
        <th>Item Description</th>
        <th>Picture</th>
        <th>Where to Find</th>
        <th>Type</th>
      </tr>
    </table>

    <script>
      const form = document.getElementById("item-form");
      const submitBtn = document.getElementById("form-submit");
      const table = document.getElementById("item-table");

      // Load saved data from localStorage when the page loads
      window.onload = function() {
        const savedItems = JSON.parse(localStorage.getItem("lostAndFoundItems")) || [];
        savedItems.forEach(item => addRowToTable(item));
      };

      // Handle form submission
      submitBtn.addEventListener("click", async (e) => {
        e.preventDefault(); // Prevent page reload
        const title = document.getElementById("item-title").value.trim();
        const desc = document.getElementById("item-desc").value.trim();
        const fileInput = document.getElementById("item-pic");
        const location = document.getElementById("item-location").value.trim();
        const type = document.getElementById("item-type").value;

        if (!title || !desc || !location) {
          alert("Please fill out all required fields.");
          return;
        }

        let imageData = "";
        if (fileInput.files && fileInput.files[0]) {
          imageData = await toBase64(fileInput.files[0]);
        }

        const newItem = { title, desc, imageData, location, type };

        addRowToTable(newItem);
        saveToLocalStorage(newItem);

        form.reset();
      });

      function toBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => resolve(reader.result);
          reader.onerror = error => reject(error);
        });
      }

      function addRowToTable(item) {
        const newRow = table.insertRow(-1);
        const titleCell = newRow.insertCell(0);
        const descCell = newRow.insertCell(1);
        const picCell = newRow.insertCell(2);
        const locationCell = newRow.insertCell(3);
        const typeCell = newRow.insertCell(4);

        titleCell.textContent = item.title;
        descCell.textContent = item.desc;
        locationCell.textContent = item.location;
        typeCell.textContent = item.type;

        if (item.imageData) {
          const img = document.createElement("img");
          img.src = item.imageData;
          img.className = "preview";
          picCell.appendChild(img);
        } else {
          picCell.textContent = "No image";
        }
      }

      function saveToLocalStorage(item) {
        const existingItems = JSON.parse(localStorage.getItem("lostAndFoundItems")) || [];
        existingItems.push(item);
        localStorage.setItem("lostAndFoundItems", JSON.stringify(existingItems));
      }
    </script>
  </body>
</html>

