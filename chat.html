<!DOCTYPE html>
<html>
<head>
    <title>RHHS Lost & Found Chat</title>
    <style rel="stylesheet" href="style.css"></style>
    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background-color: #f4f8ff;
            color: #003366;
            margin: 0;
            padding-bottom: 100px;
        }

        h1 {
            background-color: #003366;
            color: #ffd700;
            margin: 0;
            padding: 15px;
            text-align: center;
        }

        cite {
            display: block;
            text-align: center;
            font-size: 10px;
            color: #666;
            margin-top: 5px;
        }

        hr {
            border: 0;
            border-top: 2px solid #ffd700;
            width: 80%;
            margin: 10px auto;
        }

        #messages {
            padding: 20px;
            margin: 0 auto;
            max-width: 800px;
            overflow-y: auto;
            min-height: 400px;
        }

        #messages p {
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin: 5px 0;
            word-wrap: break-word;
        }

        #typingIndicator {
            text-align: center;
            color: gray;
            font-size: 13px;
            margin-bottom: 5px;
        }

        #username, #chat {
            width: calc(100% - 20px);
            max-width: 800px;
            display: block;
            margin: 10px auto;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
            outline: none;
            transition: 0.3s;
        }

        #username:focus, #chat:focus {
            border-color: #003366;
            box-shadow: 0 0 5px #00336633;
        }

        #userList {
            position: fixed;
            top: 20px;
            right: 20px;
            border: 2px solid #003366;
            background-color: #ffffff;
            color: #003366;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            font-size: 14px;
        }

        strong {
            color: #003366;
        }

        img {
            border-radius: 6px;
            margin-top: 5px;
        }
        .message-container {
    position: relative;
    margin-bottom: 10px;
}

.delete-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: #ffd700;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 12px;
    color: #003366;
    transition: 0.3s;
}

.delete-btn:hover {
    background-color: #ffcc00;
}

    </style>

</head>
<body>
    <h1>RHHS Lost and Found Chat</h1>
    <cite>Use this chat to discuss or help identify lost and found items. Please be respectful.</cite>
    <button style=" background-color:  #003366; margin-right: 45%; margin-left: 45%; width: 10%;"><a href="index.html" style="color: yellow;">Back To Site</a></button>
    <hr>

    <div id="messages"></div>
    <div id="typingIndicator"></div>
    <div id="userList"><strong>Active Users:</strong></div>

    <input id="username" placeholder="Enter your name..." maxlength="20" />
    <input id="chat" placeholder="Type a message (or share an image URL)..." maxlength="200" />

    <script>
        let activeUsers = new Set();
        let typingTimeout;
        let isAdmin = false;
        checkAdmin = function () {
            if (sessionStorage.getItem("isAdmin", "true")) {
            let isAdmin = true;
        }
        };
        function addUser(username) {
            activeUsers.add(username);
            updateUserList();
        }

        function removeUser(username) {
            activeUsers.delete(username);
            updateUserList();
        }

        function updateUserList() {
            const userList = document.getElementById('userList');
            userList.innerHTML = '<strong>Active Users:</strong><br>' + Array.from(activeUsers).join('<br>');
        }

        function showTypingIndicator(username) {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.textContent = `${username} is typing...`;
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                typingIndicator.textContent = '';
            }, 3000);
        }

        function addMessage(message, username) {
    const chatMessages = document.getElementById('messages');
    const timestamp = new Date().toLocaleTimeString();

    const messageContainer = document.createElement('div');
    messageContainer.classList.add('message-container');

    const messageElement = document.createElement('p');
    if (isImageURL(message)) {
        messageElement.innerHTML = `[${timestamp}] <b>${username}</b>:<br><img src="${message}" style="max-width: 100%; max-height: 200px;">`;
    } else {
        messageElement.innerHTML = `[${timestamp}] <b>${username}</b>: ${message}`;
    }
    
    if (isAdmin) {
        const deleteButton = document.createElement('button');
        deleteButton.textContent = "🗑️ Delete";
        deleteButton.classList.add('delete-btn');
        deleteButton.onclick = function() {
            messageContainer.remove();
            saveMessages();
        };
        messageContainer.appendChild(deleteButton);
    }

    messageContainer.appendChild(messageElement);
    chatMessages.appendChild(messageContainer);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    saveMessages();
}


        function isImageURL(url) {
            return url.match(/\.(jpeg|jpg|gif|png)$/) != null;
        }

        function saveMessages() {
            const chatMessages = document.getElementById('messages');
            const messages = Array.from(chatMessages.children).map(child => child.innerHTML);
            localStorage.setItem('chatMessages', JSON.stringify(messages));
        }

        function loadMessages() {
            const chatMessages = document.getElementById('messages');
            const savedMessages = JSON.parse(localStorage.getItem('chatMessages')) || [];
            chatMessages.innerHTML = '';
            savedMessages.forEach(message => {
                const messageElement = document.createElement('p');
                messageElement.innerHTML = message;
                chatMessages.appendChild(messageElement);
            });
        }

        function resetMessages() {
            const now = new Date().getTime();
            const lastReset = localStorage.getItem('lastReset') || 0;
            const oneHour = 60 * 60 * 1000;
            if (now - lastReset > oneHour) {
                localStorage.setItem('lastReset', now);
                localStorage.removeItem('chatMessages');
                loadMessages();
            }
        }



        document.addEventListener('DOMContentLoaded', () => {
            loadMessages();
            resetMessages();
            setInterval(resetMessages, 60 * 60 * 1000);
        });

        document.getElementById('chat').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                const message = document.getElementById('chat').value.trim();
                const username = document.getElementById('username').value.trim();
                if (message && username) {
                    if (isAdmin && message.startsWith('/ban ')) {
                        const userToBan = message.substring(5).trim();
                        activeUsers.delete(userToBan);
                        updateUserList();
                        addMessage(`User '${userToBan}' has been banned by Admin.`, 'Admin');
                    } else {
                        addMessage(message, username);
                    }
                    document.getElementById('chat').value = '';
                } else {
                    alert("Please enter both your name and a message.");
                }
            } else {
                const username = document.getElementById('username').value.trim();
                if (username) showTypingIndicator(username);
            }
        });

        document.getElementById('username').addEventListener('blur', function() {
            const username = document.getElementById('username').value.trim();
            if (username) {
                addUser(username);
                checkAdmin(username);
            }
        });

        document.getElementById('username').addEventListener('focus', function() {
            const username = document.getElementById('username').value.trim();
            if (username) removeUser(username);
        });

    </script>
</body>
</html>
